@model IEnumerable<OHC.EAMI.WebUI.ViewModels.AssignPaymentRecordsViewModel>

@{
    ViewBag.Title = "AssignPaymentRecords";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<script src="~/Scripts/DataTables/jquery.dataTables.min.js"></script>




<script src="~/Scripts/DataTables/dataTables.bootstrap4.min.js"></script>
@*<link href="~/Content/DataTables/css/jquery.dataTables.min.css" rel="stylesheet" />*@
<link href="~/Content/DataTables/css/dataTables.bootstrap4.min.css" rel="stylesheet" />
@*<script type="text/javascript" src="http://ajax.cdnjs.com/ajax/libs/json2/20110223/json2.js"></script>*@

@*-------------------------------------------------------------------------------------------------------------*@
@*<link href="https://cdn.datatables.net/1.10.16/css/jquery.dataTables.min.css" rel="stylesheet" />
    <script src="https://cdn.datatables.net/1.10.16/js/jquery.dataTables.min.js"></script>*@

@*-------------------------------------------------------------------------------------------------------------*@

<script src="~/Scripts/numeral/numeral.min.js"></script>

@*<link type="text/css" href="https://cdn.datatables.net/select/1.2.3/css/select.dataTables.min.css" rel="stylesheet" />
    <script type="text/javascript" src="https://cdn.datatables.net/select/1.2.3/js/dataTables.select.min.js"></script>*@

<link type="text/css" href="~/Scripts/select/1.2.3/css/select.dataTables.min.css" rel="stylesheet" />
<script type="text/javascript" src="~/Scripts/select/1.2.3/js/dataTables.select.min.js"></script>

<link type="text/css" href="~/Scripts/jquery-datatables-checkboxes-1.2.9/jquery-datatables-checkboxes-1.2.9/css/dataTables.checkboxes.css" rel="stylesheet" />
<script type="text/javascript" src="~/Scripts/jquery-datatables-checkboxes-1.2.9/jquery-datatables-checkboxes-1.2.9/js/dataTables.checkboxes.min.js"></script>



@*-----Boiler Plate--------------------------------------------------------------------------------------------*@
<link type="text/css" href="~/Scripts/EAMI_Boilerplate/css/eami.css" rel="stylesheet" />
<link type="text/css" href="~/Scripts/EAMI_Boilerplate/css/bootstrap.css" rel="stylesheet" />
<script type="text/javascript" src="~/Scripts/EAMI_Boilerplate/js/eami.js"></script>
@*-------------------------------------------------------------------------------------------------------------*@



@*<meta name="viewport" content="width=device-width, initial-scale=1">*@
@*<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">*@
@*<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>*@




<!-- Latest compiled and minified CSS -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.12.4/css/bootstrap-select.min.css">

<!-- Latest compiled and minified JavaScript -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.12.4/js/bootstrap-select.min.js"></script>

<!-- (Optional) Latest compiled and minified JavaScript translation files -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.12.4/js/i18n/defaults-*.min.js"></script>




@*<script src="~/Scripts/jquery-1.8.2.js"></script>
<script src="~/Scripts/jquery.unobtrusive-ajax.js"></script>
<script src="~/Scripts/jquery.unobtrusive-ajax.min.js"></script>*@



<style type="text/css">
    .no-padding {
        padding: 0px !important;
        margin: 0px !important;
        border: none !important;
    }

    .no-padding-left-right {
        padding-left: 0px !important;
        padding-right: 0px !important;
    }

    .rowDetails {
        background-color: #fcf8e3 !important;
        /*border-radius: 25px;*/
    }

    .col1-style {
        width: 10px;
    }

    .col2-style {
        width: 10px;
    }

    .col3-style {
        width: 60px;
    }

    .col4-style {
        width: 20px;
    }

    .borderLine {
        border-top: 3px double #8c8b8b;
    }

    #searchMenu .panel {
        display: inline-block;
    }

    .modal-customSize {
        width: 90%;
    }

    /*EAMI Colors*****************************************************************************************************/
    .EAMI_Text_BlueSteel {
        color: #3d5475 !important;
    }

    .EAMI_Text_Purple {
        color: #4f0c4c !important;
    }

    .EAMI_Text_White {
        color: #fff !important;
    }

    .EAMI_Text_Warning {
        color: gold !important;
    }

    .EAMI_Text_Danger {
        color: red !important;
    }

    .EAMI_BgColor_BlueSteel {
        background-color: #3d5475 !important;
    }

    .EAMI_BgColor_Purple {
        background-color: #4f0c4c !important;
    }

    .EAMI_BgColor_White {
        background-color: #fff !important;
    }

    .EAMI_BtnRadius {
        border-radius: 4px !important;
    }

    .selectorWidth {
        width: 1em;
    }

    .modal-content {
        overflow: hidden;
    }

    .modal-header {
        background-color: #4f0c4c !important; /*EAMI_BgColor_Purple*/
        color: #fff !important; /*EAMI_Text_White*/
        border-bottom: 0;
    }

    .modal-body {
        position: relative;
        padding: 0;
    }
    /*.modal-footer {*/
    /*background-color: #4f0c4c !important;*/ /*EAMI_BgColor_Purple*/
    /*color: #fff !important;*/ /*EAMI_Text_White*/
    /*}*/



    /*****************************************************************************************************************/


    /*.ddlSystemSelect option {
        white-space: pre !important;
    }*/
    /*.ddlSystemOption {
        white-space: nowrap !important;
        overflow: hidden !important;
        text-overflow: ellipsis !important;
    }*/



    .wrapperFlagged {
        color: red;
    }

        .wrapperFlagged:hover {
            cursor: help;
        }

        .wrapperFlagged button:hover {
            cursor: help;
            color: red;
        }

    .wrapperOnHold {
        color: gold;
    }

        .wrapperOnHold:hover {
            cursor: help;
        }

    .wrapperSentBackFromProcessor {
        color: red;
    }

        .wrapperSentBackFromProcessor:hover {
            cursor: help;
        }

    .popover-title {
        color: #000 !important; /*black*/
    }

    .popover-content {
        color: #000 !important; /*black*/
    }
</style>


<form id="formSearchMenu">
    <div class="collapse" id="searchMenu">
        <div class="panel panel-dhcs-primary" style="margin-bottom:0;border-radius:0 0 4px 0;border-right:none;border-bottom:none;border-left:none;">
            <div class="panel-heading" style="border-radius:0 0 4px 0;overflow:no-display;">

                <div class="form-inline">
                    <div class="form-group">
                        <select id="ddlSystem" class="form-control selectpicker" data-live-search="true" data-width="8em" title="System">
                            <option value="0">CAPMAN</option>
                            <option value="1">Short Doyle</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <select id="ddlPaymentRecordStatus" class="form-control selectpicker" data-live-search="true" data-width="9em" title="Status">
                            <option value="0">UnAssigned</option>
                            <option value="1">Assigned</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <select id="ddlPaymentExchangeEntity" class="form-control selectpicker" data-live-search="true" data-width="25.7em"
                                multiple title="Payee" data-selected-text-format="count>1" data-actions-box="true">
                        </select>
                    </div>
                    <div class="form-group">
                        <select id="ddlPaymentType" class="form-control selectpicker" data-live-search="true" data-width="17em"
                                multiple title="Payment Type" data-selected-text-format="count>1" data-actions-box="true">
                        </select>
                    </div>
                    <div class="form-group">
                        <select id="ddlContractNumber" class="form-control selectpicker" data-live-search="true" data-live-search-style="startsWith" data-width="13em"
                                multiple title="Contract #" data-selected-text-format="count>1" data-actions-box="true">
                        </select>
                    </div>
                    <button class="btn btn-dhcs-secondary" type="button" id="btnSearch">
                        <span class="glyphicon glyphicon-search"></span> Search
                    </button>
                    <button class="btn btn-dhcs-secondary" type="button" id="btnReset">
                        <span class="glyphicon glyphicon-refresh"></span> Reset
                    </button>
                </div>
            </div>
        </div>
    </div>
</form>

<div class="form-inline">
    <div class="form-group">
        <button id="btnSearchMenu" style="border-radius:0 0 4px 4px;" class="btn btn-dhcs-secondary inactive" type="button" data-toggle="collapse" data-target="#searchMenu" aria-expanded="false" aria-controls="searchMenu">
            Search Options
        </button>
    </div>
    <div class="form-group pull-right">
        <img class="pull-right" src="~/Scripts/EAMI_Boilerplate/img/dhcs-logo-1.png">
    </div>
</div>

<br /><br /><br />


@*<div class="panel panel-dhcs-secondary" style="background: green; padding: 0px !important; margin: 0px !important; border: 0px !important">
    <div class="panel-heading" style="background: red; padding: 0px !important; margin: 0px !important;">*@

<div class="panel panel-dhcs-secondary">
    <div class="panel-heading">
        <label style="font-size: 1.7em; font-weight: normal; display: block; margin-top: 0; margin-bottom: 0; padding-top: 0; padding-bottom: 0;">PAYMENT ASSIGNMENT</label>
    </div>
</div>

<!-- Modal for Assign -->
<div class="modal fade" id="modalWrapperForAssign" tabindex="-1" role="dialog" aria-labelledby="modalHeaderForAssign" data-backdrop="true" style="margin-top:100px;">
    <div class="modal-dialog modal-md" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="modalHeaderForAssign"></h4>
            </div>
            <div class="modal-body" id="modalBodyForAssign">
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-dhcs-secondary">Assign</button>
                <button type="button" class="btn btn-dhcs-secondary" data-dismiss="modal">Cancel</button>
            </div>
        </div>
    </div>
</div>

<!-- Modal for Hold -->
<div class="modal fade" id="modalWrapperForHold" tabindex="-1" role="dialog" aria-labelledby="modalHeaderForHold" data-backdrop="true" style="margin-top:100px;">
    <div class="modal-dialog modal-md" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="modalHeaderForHold"></h4>
            </div>
            <div class="modal-body" id="modalBodyForHold">
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-dhcs-secondary" id="modalFooterForHold_HoldBtn">Hold</button>
                <button type="button" class="btn btn-dhcs-secondary" id="modalFooterForHold_CancelBtn" data-dismiss="modal">Cancel</button>
            </div>
        </div>
    </div>
</div>

<!-- Modal for UnHold -->
<div class="modal fade" id="modalWrapperForUnHold" tabindex="-1" role="dialog" aria-labelledby="modalHeaderForUnHold" data-backdrop="true" style="margin-top:100px;">
    <div class="modal-dialog modal-md" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="modalHeaderForUnHold"></h4>
            </div>
            <div class="modal-body" id="modalBodyForUnHold">
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-dhcs-secondary" id="modalFooterForUnHold_UnHoldBtn">UnHold</button>
                <button type="button" class="btn btn-dhcs-secondary" id="modalFooterForUnHold_CancelBtn" data-dismiss="modal">Cancel</button>
            </div>
        </div>
    </div>
</div>

<!-- Modal for Return -->
<div class="modal fade" id="modalWrapperForReturn" tabindex="-1" role="dialog" aria-labelledby="modalHeaderForReturn" data-backdrop="true" style="margin-top:100px;">
    <div class="modal-dialog modal-md" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="modalHeaderForReturn"></h4>
            </div>
            <div class="modal-body" id="modalBodyForReturn">
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-dhcs-secondary" id="modalFooterForReturn_ReturnBtn">Return</button>
                <button type="button" class="btn btn-dhcs-secondary" id="modalFooterForReturn_CancelBtn" data-dismiss="modal">Cancel</button>
            </div>
        </div>
    </div>
</div>

<!-- Modal for CompleteDenyReturn -->
<div class="modal fade" id="modalWrapperForCompleteDenyReturn" tabindex="-1" role="dialog" aria-labelledby="modalHeaderForCompleteDenyReturn" data-backdrop="true" style="margin-top:100px;">
    <div class="modal-dialog modal-md" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="modalHeaderForCompleteDenyReturn"></h4>
            </div>
            <div class="modal-body" id="modalBodyForCompleteDenyReturn">
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-dhcs-secondary" id="modalFooterForCompleteDenyReturn_ReturnBtn">Return</button>
                <button type="button" class="btn btn-dhcs-secondary" id="modalFooterForCompleteDenyReturn_DenyBtn">Deny</button>
            </div>
        </div>
    </div>
</div>

<!-- Modal for Mixed Payment Records Selected -->
<div class="modal fade" id="modalWrapperForMixedPaymentRecordsSelected" tabindex="-1" role="dialog" aria-labelledby="modalHeaderForMixedPaymentRecordsSelected" data-backdrop="true" style="margin-top:100px;">
    <div class="modal-dialog modal-md" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="modalHeaderForMixedPaymentRecordsSelected"></h4>
            </div>
            <div class="modal-body" id="modalBodyForMixedPaymentRecordsSelected">
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-dhcs-secondary" id="modalFooterForMixedPaymentRecordsSelected_CloseBtn" data-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>

<div class="form-inline">
    <div class="form-group pull-right">
        <button class="btn btn-dhcs-secondary" type="button" id="btnAssignPayDate">
            <span class="glyphicon glyphicon-calendar"></span>&nbsp;Assign Pay Date
        </button>
        <button class="btn btn-dhcs-secondary" type="button" id="btnAssign">
            <span class="glyphicon glyphicon-user"></span>&nbsp;Assign
        </button>
        <button class="btn btn-dhcs-secondary" type="button" id="btnHold">
            <span class="glyphicon glyphicon-pause"></span>&nbsp;Hold
        </button>
        <button class="btn btn-dhcs-secondary" type="button" id="btnReturn">
            <span class="glyphicon glyphicon-share-alt"></span>&nbsp;Return
        </button>
    </div>
</div>

<br /><br />

<div class="panel panel-dhcs-primary">
    <div class="panel-heading">
        <div class="container-fluid">
            <div class="row" style="font-weight: bold;">
                <div class="col-md-6">Search Results</div>
                <div class="col-md-6 text-right">
                    <span class="wrapperFlagged" title="" data-toggle="popover" data-placement="bottom" data-trigger="hover"
                          data-content="<p>This flag can be in one of the following states:</p>
                                            <p>
                                                <button type='button' class='btn btn-default btn-xs wrapperFlagged' style='background-color:gold;border-color:#333;'>
                                                    <span class='glyphicon glyphicon-flag'></span>
                                                </button> Payee-PaymentType groupings include Payment Records that are On Hold and Processor Returned.
                                            </p>
                                            <p>
                                                <button type='button' class='btn btn-default btn-xs wrapperOnHold EAMI_BgColor_White' style='background-color:gold;border-color:#333;'>
                                                    <span class='glyphicon glyphicon-flag'></span>
                                                </button> Payee-PaymentType groupings include Payment Records that are On Hold.
                                            </p>
                                            <p>
                                                <button type='button' class='btn btn-default btn-xs wrapperSentBackFromProcessor EAMI_BgColor_White' style='background-color:gold;border-color:#333;'>
                                                    <span class='glyphicon glyphicon-flag'></span>
                                                </button> Payee-PaymentType groupings include Payment Records that are Processor Returned.
                                            </p>
                                            <p>When pressed, Supervisor can choose one of the following options:
                                                <ul>
                                                    <li>UnHold selected payment records.</li>
                                                    <li>Complete or Deny Return of selected payment records.  Denial will send payment record back to processor who initiated the return.</li>
                                                </ul>
                                            </p>" data-html="true">
                            <button type="button" class="btn btn-default btn-xs wrapperFlagged" style="background-color:gold;border-color:#333;">
                                <span class="glyphicon glyphicon-flag"></span>
                            </button> <span class="EAMI_Text_White wrapperFlagged">Flagged</span>
                        </span>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    <span class="wrapperOnHold" title="" data-toggle="popover" data-placement="bottom" data-trigger="hover"
                          data-content="<p>Indicates when Payment Record is On Hold.</p><p>(Read-Only Flag)</p>" data-html="true">
                        <span class="glyphicon glyphicon-flag"></span> <span class="EAMI_Text_White">On Hold</span>
                    </span>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    <span class="wrapperSentBackFromProcessor" title="" data-toggle="popover" data-placement="bottom" data-trigger="hover"
                          data-content="<p>Indicates when Payment Record is Sent back from the Processor to the Supervisor for further action.</p><p>(Read-Only Flag)</p>" data-html="true">
                        <span class="glyphicon glyphicon-flag"></span> <span class="EAMI_Text_White">Processor Returned</span>
                    </span>
                </div>
            </div>
        </div>
    </div>
    <div class="panel-body" id="divContainerForTblPayeePaymentType">
        <table id="tblPayeePaymentType" class="table table-hover" cellspacing="0" width="100%">
            <thead style="display:none;">
                <tr class="EAMI_Text_White EAMI_BgColor_BlueSteel" style="border-color:#344864;">
                    <th></th>


                    <th></th>


                    <th>Search Results</th>
                    <th></th>



 

                </tr>
            </thead>
            <tbody>
                @foreach (var assignPaymentRecordsViewModel in Model)
                {
                    <tr id="trPayeePaymentType_@Html.DisplayFor(m => assignPaymentRecordsViewModel.PayeeDisplayId)" style="font-weight: bold;">

                        


                        <td id="tdPayeePaymentTypeFlag_@Html.DisplayFor(m => assignPaymentRecordsViewModel.PayeeDisplayId)" style="width: 0.5em;">


                            


                            <button type="button" class="btn btn-default btn-xs btnInTdPayeePaymentTypeFlag" style="background-color:gold;border-color:#333;" id="btnPayeePaymentTypeFlag_@Html.DisplayFor(m => assignPaymentRecordsViewModel.PayeeDisplayId)">
                                <span class="glyphicon glyphicon-flag wrapperSentBackFromProcessor"></span>
                            </button>
                        </td>
                        <td id="tdPayeePaymentType_@Html.DisplayFor(m => assignPaymentRecordsViewModel.PayeeDisplayId)" style="width: 0.5em;">
                            <button type="button" class="btn btn-default btn-xs btnInTdPayeePaymentType" style="color:#fff;background-color:#333;border-color:#333;">
                                <span class="glyphicon glyphicon-plus"></span>
                            </button>
                        </td>
                        <td>
                            <span class="EAMI_Text_BlueSteel">@Html.DisplayFor(m => assignPaymentRecordsViewModel.PayeeName)</span> -
                            <span class="EAMI_Text_Purple">@Html.DisplayFor(m => assignPaymentRecordsViewModel.PaymentTypeName)</span>
                        </td>

                        <td class="PayeePaymentTypeTotalAmount" width="300em">Selected Payment Total: @Html.DisplayFor(m => assignPaymentRecordsViewModel.TotalAmount)</td>

                        
                    </tr>
                }

                @if (Model.Count() == 0)
                {
                    <tr class="EAMI_BgColor_White">
                        <td></td>
                        <td style="width:100%;text-align:center;"><br />Please Select Search Criteria And Then Press Search.</td>
                        <td></td>
                        <td></td>


                    </tr>
                }
            </tbody>
        </table>
    </div>
</div>

<script type="text/javascript">


    // DataTable Initialization ***********************************************************************************

    $(document).ready(function () {
        var outterMostTableId = "tblPayeePaymentType";

        var datatablePaymentRecordsGrouped;
        //var datatablePaymentRecordsGrouped = $('#' + outterMostTableId).DataTable(
        //    {
        //        "filter": false, // this is for disable filter (search box)
        //        "paging": false,
        //        "info": false,
        //        //"order": [[1, "asc"]]
        //        "order": [[2, "asc"]]
        //    });

        var maxLengthOfCommentsTextArea = 200;

        //// Add event listener for opening and closing details (+/- button) ********************************************
        //$('#' + outterMostTableId + ' tbody tr td').on('click', 'button.btnInTdPayeePaymentType', function () {






        //    $(this).find("span").toggleClass('glyphicon-plus');
        //    $(this).find("span").toggleClass('glyphicon-minus');

        //    var tdPayeePaymentType_id = $(this).parent().attr('id');
        //    var trPayeePaymentType_id = tdPayeePaymentType_id.replace("tdPayeePaymentType_", "trPayeePaymentType_");
        //    var payeeDisplayId = tdPayeePaymentType_id.replace("tdPayeePaymentType_", "");
        //    var divChildOfTrPayeePaymentType_id = trPayeePaymentType_id.replace("trPayeePaymentType_", "divChildOfTrPayeePaymentType_");

        //    var tr = $(this).closest('#' + trPayeePaymentType_id);
        //    var row = datatablePaymentRecordsGrouped.row(tr);

        //    if (row.child.isShown()) {
        //        // This row is already open - close it
        //        $('#' + divChildOfTrPayeePaymentType_id, row.child()).slideUp(250, function () {
        //            row.child.hide();
        //            tr.removeClass('shown');
        //        });
        //    }
        //    else {
        //        // Open this row
        //        ajaxGetPaymentRecords(row, row.data(), tr, trPayeePaymentType_id, payeeDisplayId, divChildOfTrPayeePaymentType_id);
        //    }
        //});

        // Helper Function ajaxGetPaymentRecordDetails(row, rowData, tr):  Returns the div to be rendered by the child row, *
        // while also using AJAX (asynchronous HTTP) request and a closure to populate that div asynchronously.
        function parseJsonDate(jsonDateString) {
            return $.datepicker.formatDate('mm/dd/yy', new Date(parseInt(jsonDateString.replace('/Date(', ''))));
        }

        /* Formatting function for row details - modify as you need */
        //function ajaxGetPaymentRecords(row, rowData, tr, trPayeePaymentType_id, payeeDisplayId, divChildOfTrPayeePaymentType_id) {
        function ajaxGetPaymentRecords(row, rowData, tr, divChildOfTrPayeePaymentType_id, payeeDisplayId, strPayeeRefCode, strPaymentTypeName) {
            $.ajax({
                type: "GET",
                url: "@Url.Action("AssignPaymentRecords_GetPaymentRecords")",
                //data: invSubTbl_id,
                data: { 'payeeDisplayId' : payeeDisplayId, 'payeeRefCode': strPayeeRefCode, 'paymentTypeName': strPaymentTypeName },
                contentType: "application/json; charset=utf-8",
                dataType: "html",
                success: ajaxGetPaymentRecords_SuccessCallBack,
                failure: function (response) {
                    //alert(response.responseText);
                    alert("BBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBB");
                },
                error: function (response) {
                    alert("error returned from ajaxGetPaymentRecords.");
                    //alert(response.responseText);
                }
            });
            function ajaxGetPaymentRecords_SuccessCallBack(returnPaymentRecords) {
                // Open this row
                var retHtmlPaymentRecords = '' +
                    '<div class="collapse no-padding" id="' + divChildOfTrPayeePaymentType_id + '">' +
                            returnPaymentRecords +
                    '</div>';
                row.child(retHtmlPaymentRecords, 'no-padding').show();

                tr.addClass('shown');
                //The delay(0) forces child table to fully load and initialize complete before sliding down.
                $('#' + divChildOfTrPayeePaymentType_id, row.child()).delay(0).slideDown(250);
            }
        }


        // End of -- Add event listener for opening and closing details (+/- button)***********************************

        // Add event listener for Assign ******************************************************************************
        $('#btnAssign').on('click', function () {
            $.ajax({
                type: "POST",
                url: "@Url.Action("AssignPaymentRecords_GetAssignees")",
                //data: invSubTbl_id,
                //data: { 'outterMostTableId': outterMostTableId, 'outterMostRowId': trPayeePaymentType_id, 'payeeDisplayId': payeeDisplayId },
                //contentType: "application/json; charset=utf-8",
                dataType: "html",
                success: ajaxGetAssignees_SuccessCallBack,
                failure: function (response) {
                    //alert(response.responseText);
                    alert("BBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBB");
                },
                error: function (response) {
                    alert("error returned from AssignPaymentRecords_GetAssignees.");
                    //alert(response.responseText);
                }
            });

            function ajaxGetAssignees_SuccessCallBack(returnAssignees) {
                //var retHtmlHeaderString = 'Assign Payment - ' + 'returnAssignees.selected.count' + ' Payments';
                var retHtmlHeaderString = 'Assign Payment - ' + 6 + ' Payments';
                var retHtmlString = '' +
                '<div class="container-fluid">' +
                    '<div class="row EAMI_BgColor_BlueSteel EAMI_Text_White" style="padding-top:15px;padding-bottom:5px;">' +
                      '<div class="col-md-1 selectorWidth"></div>' +
                      '<div class="col-md-5"><strong>Name</strong></div>' +
                      '<div class="col-md-2"><strong>User</strong></div>' +
                      '<div class="col-md-4"><strong>Assigned Payments</strong></div>' +
                    '</div>' +
                    '<div class="row" style="padding-top:5px;padding-bottom:5px;">' +
                    '</div>' +





                    '<div class="row" style="padding-top:5px;padding-bottom:5px;">' +
                      '<div class="col-md-1 selectorWidth"><input type="radio" name="radioUser" style="margin-top: 0.22em;"></div>' +
                      '<div class="col-md-5">Cailin Kardashian</div>' +
                      '<div class="col-md-2">Processor</div>' +
                      '<div class="col-md-4">74</div>' +
                    '</div>' +
                    '<div class="row" style="padding-top:5px;padding-bottom:5px;">' +
                      '<div class="col-md-1 selectorWidth"><input type="radio" name="radioUser" style="margin-top: 0.22em;"></div>' +
                      '<div class="col-md-5">Cailin Kardashian</div>' +
                      '<div class="col-md-2">Processor</div>' +
                      '<div class="col-md-4">74</div>' +
                    '</div>' +
                    '<div class="row" style="padding-top:5px;padding-bottom:5px;">' +
                      '<div class="col-md-1 selectorWidth"><input type="radio" name="radioUser" style="margin-top: 0.22em;"></div>' +
                      '<div class="col-md-5">Cailin Kardashian</div>' +
                      '<div class="col-md-2">Processor</div>' +
                      '<div class="col-md-4">74</div>' +
                    '</div>' +
                    '<div class="row" style="padding-top:5px;padding-bottom:5px;">' +
                      '<div class="col-md-1 selectorWidth"><input type="radio" name="radioUser" style="margin-top: 0.22em;"></div>' +
                      '<div class="col-md-5">Cailin Kardashian</div>' +
                      '<div class="col-md-2">Processor</div>' +
                      '<div class="col-md-4">74</div>' +
                    '</div>' +
                    '<div class="row" style="padding-top:5px;padding-bottom:5px;">' +
                      '<div class="col-md-1 selectorWidth"><input type="radio" name="radioUser" style="margin-top: 0.22em;"></div>' +
                      '<div class="col-md-5">Cailin Kardashian</div>' +
                      '<div class="col-md-2">Processor</div>' +
                      '<div class="col-md-4">74</div>' +
                    '</div>' +





                    '<div class="row" style="padding-top:5px;padding-bottom:5px;">' +
                    '</div>' +
                '</div>'; +


                $("#modalHeaderForAssign").html(retHtmlHeaderString);
                $("#modalBodyForAssign").html(retHtmlString);
                $('#modalWrapperForAssign').modal('show');
            }
        });
        // ************************************************************************************************************

        // Add event listener for Hold ********************************************************************************
        $('#btnHold').on('click', function () {
            var retHtmlHeaderString = 'Hold Payment';
            var retHtmlString = '' +
            '<div class="container-fluid">' +
                '<div class="form-group" style="padding-top:15px;">' +
                    '<label for="txtareaHoldComment">Comment:</label>' +
                    '<textarea class="form-control" id="txtareaHoldComment" placeholder="Comment Required" rows="10"></textarea>' +
                '</div>' +
                '<div class="alert alert-danger" style="display: none; margin-top: 10px;" id="danger_alert"></div>' +
            '</div>';

            $("#modalHeaderForHold").html(retHtmlHeaderString);
            $("#modalBodyForHold").html(retHtmlString);
            $('#modalWrapperForHold').modal('show');

            $("#txtareaHoldComment").on("change keyup paste", function () {
                var maxLength = maxLengthOfCommentsTextArea;
                var currentVal = $(this).val();
                var currentLength = $(this).val().length;
                if (currentLength > maxLength) {
                    $("#modalWrapperForHold #danger_alert").html("Your entry of <span style='color:blue;'>" + currentLength + "</span> " +
                        "characters exceeds the maximum <span style='color:blue;'>" + maxLength + "</span> characters allowed." +
                        "<br />Please reduce the number of characters entered.");
                    $("#modalWrapperForHold #danger_alert").slideDown();
                    $('#modalFooterForHold_HoldBtn').prop("disabled", true);
                }
                else {
                    $('#modalFooterForHold_HoldBtn').prop("disabled", false);
                    $("#modalWrapperForHold #danger_alert").slideUp();
                }
            });

            $("#modalFooterForHold_CancelBtn").on("click", function () {
                $('#modalFooterForHold_HoldBtn').prop("disabled", false);
            });
        });
        // ************************************************************************************************************

        // Add event listener for Return ******************************************************************************
        function returnPaymentRecords() {
            var retHtmlHeaderString = 'Return Payment';
            var retHtmlString = '' +
            '<div class="container-fluid">' +
                '<div class="form-group" style="padding-top:15px;">' +
                    '<label for="txtareaReturnComment">Comment:</label>' +
                    '<textarea class="form-control" id="txtareaReturnComment" placeholder="Comment Required" rows="10"></textarea>' +
                '</div>' +
                '<div class="alert alert-danger" style="display: none; margin-top: 10px;" id="danger_alert"></div>' +
            '</div>';

            $("#modalHeaderForReturn").html(retHtmlHeaderString);
            $("#modalBodyForReturn").html(retHtmlString);
            $('#modalWrapperForReturn').modal('show');

            $("#txtareaReturnComment").on("change keyup paste", function () {
                var maxLength = maxLengthOfCommentsTextArea;
                var currentVal = $(this).val();
                var currentLength = $(this).val().length;
                if (currentLength > maxLength) {
                    $("#modalWrapperForReturn #danger_alert").html("Your entry of <span style='color:blue;'>" + currentLength + "</span> " +
                        "characters exceeds the maximum <span style='color:blue;'>" + maxLength + "</span> characters allowed." +
                        "<br />Please reduce the number of characters entered.");
                    $("#modalWrapperForReturn #danger_alert").slideDown();
                    $('#modalFooterForReturn_ReturnBtn').prop("disabled", true);
                }
                else {
                    $('#modalFooterForReturn_ReturnBtn').prop("disabled", false);
                    $("#modalWrapperForReturn #danger_alert").slideUp();
                }
            });

            $("#modalFooterForReturn_CancelBtn").on("click", function () {
                $('#modalFooterForReturn_ReturnBtn').prop("disabled", false);
            });
        }

        // Call Return Modal
        $('#btnReturn').on('click', function () {
            returnPaymentRecords();
        });
        // ************************************************************************************************************






        // Add event listeners for Search Menu Bar ********************************************************************

        // AJAX Functions *********************************************************************************************
        function ajaxGetAssignPaymentRecords_Search(strSystem, strPaymentRecordStatusId,
            arrayPayeeName, arrayPaymentTypeName, arrayContractNumber) {
            $.ajax({
                type: "GET",
                url: "@Url.Action("AssignPaymentRecords_Search")",
                data: {
                    'system': strSystem, 'paymentRecordStatusId': strPaymentRecordStatusId,
                    'arrayPayeeName': arrayPayeeName, 'arrayPaymentTypeName': arrayPaymentTypeName, 'arrayContractNumber': arrayContractNumber
                },
                contentType: "application/json; charset=utf-8",
                dataType: "html",
                traditional: true,  //This is required when passing array.
                success: ajaxGetAssignPaymentRecords_Search_SuccessCallBack,
                failure: function (response) {
                    //alert(response.responseText);
                    alert("BBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBB");
                },
                error: function (response) {
                    alert("error returned from:  AssignPaymentRecords_Search");
                    //alert(response.responseText);
                }
            });

        }

        function ajaxGetAssignPaymentRecords_Search_SuccessCallBack(returnPayeePaymentTypeTable) {
            // Reload outtermost table
            $('#divContainerForTblPayeePaymentType').html(returnPayeePaymentTypeTable);

            // Rebind outtermost datatable
            datatablePaymentRecordsGrouped = $('#' + outterMostTableId).DataTable(
                {
                    "filter": false, // this is for disable filter (search box)
                    "paging": false,
                    "info": false,
                    "order": [[2, "asc"]]
                });

            // Add event listener for opening and closing details (+/- button) ********************************************
            $('#' + outterMostTableId + ' tbody tr td').on('click', 'button.btnInTdPayeePaymentType', function () {
                $(this).find("span").toggleClass('glyphicon-plus');
                $(this).find("span").toggleClass('glyphicon-minus');
                var tdPayeePaymentType_id = $(this).parent().attr('id');
                var trPayeePaymentType_id = tdPayeePaymentType_id.replace("tdPayeePaymentType_", "trPayeePaymentType_");
                var payeeDisplayId = tdPayeePaymentType_id.replace("tdPayeePaymentType_", "");
                var divChildOfTrPayeePaymentType_id = trPayeePaymentType_id.replace("trPayeePaymentType_", "divChildOfTrPayeePaymentType_");
                var tr = $(this).closest('#' + trPayeePaymentType_id);
                var row = datatablePaymentRecordsGrouped.row(tr);
                if (row.child.isShown()) {
                    // This row is already open - close it
                    $('#' + divChildOfTrPayeePaymentType_id, row.child()).slideUp(250, function () {
                        row.child.hide();
                        tr.removeClass('shown');
                    });
                }
                else {
                    var strPayeeRefCode = tr.find('input[type="hidden"]').val();
                    var strPaymentTypeName = tr.find('span[id="PaymentTypeName"]').html();
                    // Open this row
                    ajaxGetPaymentRecords(row, row.data(), tr, divChildOfTrPayeePaymentType_id, payeeDisplayId, strPayeeRefCode, strPaymentTypeName);
                }
            });

            // Add event listener for calling Appropriate Modal on Flag Click *********************************************
            $('#' + outterMostTableId + ' tbody tr td').on('click', 'button.btnInTdPayeePaymentTypeFlag', function () {
                var tdPayeePaymentType_id = $(this).parent().attr('id');
                var trPayeePaymentType_id = tdPayeePaymentType_id.replace("tdPayeePaymentType_", "trPayeePaymentType_");
                var payeeDisplayId = tdPayeePaymentType_id.replace("tdPayeePaymentType_", "");
                var divChildOfTrPayeePaymentType_id = trPayeePaymentType_id.replace("trPayeePaymentType_", "divChildOfTrPayeePaymentType_");

                var tr = $(this).closest('#' + trPayeePaymentType_id);
                var row = datatablePaymentRecordsGrouped.row(tr);

                if (row.child.isShown()) {
                    if (1 == 2) {
                        //returnPaymentRecords();
                    }
                    else {
                        //completeDenyPaymentRecordsReturn()
                        getWarning_MixedPaymentRecordsSelected();
                        //unHoldPaymentRecords()
                    }
                }
                else {
                    // Row not expanded
                    getWarning_PayeePaymentTypesRowNotExpanded();
                }
            });




        }

        // Call


        function GetSelectedOptionsAsArray(idDropDownList, boolWantValues, boolWantText) {
            var options = $("#" + idDropDownList + " option:selected");
            var retArray = null;
            if (boolWantValues) {
                var values = $.map(options, function (option) {
                    return option.value;
                });
                retArray = values;
            }
            else if (boolWantText) {
                var texts = $.map(options, function (option) {
                    return option.text;
                });
                retArray = texts;
            }
            else {  //catch-all
                var texts = $.map(options, function (option) {
                    return option.text;
                });
                retArray = texts;
            }
            return retArray;
        }


        $('#btnSearch').on('click', function () {
            ajaxGetAssignPaymentRecords_Search( $("#ddlSystem option:selected").text(),
                                                $("#ddlPaymentRecordStatus option:selected").val(),
                                                GetSelectedOptionsAsArray("ddlPaymentExchangeEntity", true, false),
                                                GetSelectedOptionsAsArray("ddlPaymentType", false, true),
                                                GetSelectedOptionsAsArray("ddlContractNumber", false, true));
        });

        @*function ajaxGetAssignPaymentRecords_GetSearchCriteriaPayees(strSystem, strPaymentRecordStatusId, arrayPayeeName, arrayPaymentTypeName, arrayContractNumber) {
            $.getJSON("@Url.Action("AssignPaymentRecords_GetSearchCriteriaPayees")", { 'system': strSystem, 'paymentRecordStatusId': strPaymentRecordStatusId,
                'arrayPayeeName': arrayPayeeName, 'arrayPaymentTypeName': arrayPaymentTypeName, 'arrayContractNumber': arrayContractNumber },
                function (data) {
                    Result = data; //Use this data for further creation of your elements.
                    var items = "";
                    //items += "<option value=''>Payee</option>";
                    $.each(data, function (i, SingleElement) {
                        var strDisplayOption = SingleElement.Description.length > 40 ? SingleElement.Description.substr(0, 40) + " ..." : SingleElement.Description;
                        items += "<option value='" + SingleElement.Code + "'>" + strDisplayOption + "</option>";
                    });

                    if ($("#ddlSystem").val() != "") {
                        $("#ddlPaymentExchangeEntity").html(items);
                        $("#ddlPaymentExchangeEntity").prop("disabled", false);
                        //$("#ddlPaymentType").html("<option value=''>Payment Type</option>");
                        $("#ddlPaymentType").val('');
                        $("#ddlPaymentType").prop("disabled", true);
                    } else {
                        $("#ddlPaymentExchangeEntity").val('');
                        $("#ddlPaymentExchangeEntity").prop("disabled", true);
                        $("#ddlPaymentType").val('');
                        $("#ddlPaymentType").prop("disabled", true);
                    }

                    $("#ddlPaymentExchangeEntity").selectpicker('refresh');
                    $("#ddlPaymentType").selectpicker('refresh');
            });
        }*@
        function ajaxGetAssignPaymentRecords_GetSearchCriteriaPayees(strSystem, strPaymentRecordStatusId,
                arrayPayeeName, arrayPaymentTypeName, arrayContractNumber) {
            $.ajax({
                    type: "GET",
                    url: "@Url.Action("AssignPaymentRecords_GetSearchCriteriaPayees")",
                    data: {
                        'system': strSystem, 'paymentRecordStatusId': strPaymentRecordStatusId,
                        'arrayPayeeName': arrayPayeeName, 'arrayPaymentTypeName': arrayPaymentTypeName, 'arrayContractNumber': arrayContractNumber
                    },
                    contentType: "application/json; charset=utf-8",
                    dataType: "json",
                    traditional: true,  //This is required when passing array.
                    success: function (data) {
                        Result = data; //Use this data for further creation of your elements.
                        var items = "";
                        //items += "<option value=''>Payee</option>";
                        $.each(data, function (i, SingleElement) {
                            var strDisplayOption = SingleElement.Description.length > 34 ? SingleElement.Description.substr(0, 34) + " ..." : SingleElement.Description;
                            items += "<option value='" + SingleElement.Description + "'>" + strDisplayOption + "</option>";
                        });

                        if ($("#ddlSystem").val() != "") {
                            $("#ddlPaymentExchangeEntity").html(items);
                            $("#ddlPaymentExchangeEntity").prop("disabled", false);
                            //$("#ddlPaymentType").html("<option value=''>Payment Type</option>");
                            $("#ddlPaymentType").val('');
                            $("#ddlPaymentType").prop("disabled", true);
                        } else {
                            $("#ddlPaymentExchangeEntity").val('');
                            $("#ddlPaymentExchangeEntity").prop("disabled", true);
                            $("#ddlPaymentType").val('');
                            $("#ddlPaymentType").prop("disabled", true);
                        }

                        $("#ddlPaymentExchangeEntity").selectpicker('refresh');
                        $("#ddlPaymentType").selectpicker('refresh');
                },
                failure: function (response) {
                    //alert(response.responseText);
                    alert("BBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBB");
                },
                error: function (response) {
                    alert("error returned from:  AssignPaymentRecords_GetSearchCriteriaPayees");
                    //alert(response.responseText);
                }
            });
        }


        @*function ajaxGetAssignPaymentRecords_GetSearchCriteriaContracts(strSystem, strPaymentRecordStatusId, arrayPayeeRefCode, arrayPaymentTypeName, arrayContractNumber) {
            $.getJSON("@Url.Action("AssignPaymentRecords_GetSearchCriteriaContracts")", { 'system': strSystem, 'paymentRecordStatusId': strPaymentRecordStatusId,
                'arrayPayeeRefCode': arrayPayeeRefCode, 'arrayPaymentTypeName': arrayPaymentTypeName, 'arrayContractNumber': arrayContractNumber },
                function (data) {
                Result = data; //Use this data for further creation of your elements.
                var items = "";
                //items += "<option value=''>Payee</option>";
                $.each(data, function (i, SingleElement) {
                    var strDisplayOption = SingleElement;
                    items += "<option value='" + i + "'>" + strDisplayOption + "</option>";
                });

                if ($("#ddlSystem").val() != "") {
                    $("#ddlContractNumber").html(items);
                    $("#ddlContractNumber").prop("disabled", false);
                } else {
                    $("#ddlContractNumber").val('');
                    $("#ddlContractNumber").prop("disabled", true);
                }

                $("#ddlContractNumber").selectpicker('refresh');
            });
        }*@

        function ajaxGetAssignPaymentRecords_GetSearchCriteriaContracts(strSystem, strPaymentRecordStatusId,
                    arrayPayeeName, arrayPaymentTypeName, arrayContractNumber) {
                $.ajax({
                    type: "GET",
                    url: "@Url.Action("AssignPaymentRecords_GetSearchCriteriaContracts")",
                    data: {
                        'system': strSystem, 'paymentRecordStatusId': strPaymentRecordStatusId,
                        'arrayPayeeName': arrayPayeeName, 'arrayPaymentTypeName': arrayPaymentTypeName, 'arrayContractNumber': arrayContractNumber
                    },
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                traditional: true,  //This is required when passing array.
                success: function (data) {
                    Result = data; //Use this data for further creation of your elements.
                    var items = "";
                    //items += "<option value=''>Payee</option>";
                    $.each(data, function (i, SingleElement) {
                        var strDisplayOption = SingleElement;
                        items += "<option value='" + i + "'>" + strDisplayOption + "</option>";
                    });

                    if ($("#ddlSystem").val() != "") {
                        $("#ddlContractNumber").html(items);
                        $("#ddlContractNumber").prop("disabled", false);
                    } else {
                        $("#ddlContractNumber").val('');
                        $("#ddlContractNumber").prop("disabled", true);
                    }

                    $("#ddlContractNumber").selectpicker('refresh');
                },
                failure: function (response) {
                    //alert(response.responseText);
                    alert("BBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBB");
                },
                error: function (response) {
                    alert("error returned from : AssignPaymentRecords_GetSearchCriteriaContracts");
                    //alert(response.responseText);
                }
            });
        }

        @*function ajaxGetAssignPaymentRecords_GetSearchCriteriaPaymentTypes(strSystem, strPaymentRecordStatusId, arrayPayeeName, arrayPaymentTypeName, arrayContractNumber) {
            $.getJSON("@Url.Action("AssignPaymentRecords_GetSearchCriteriaPaymentTypes")", { 'system': strSystem, 'paymentRecordStatusId': strPaymentRecordStatusId,
                'arrayPayeeName': arrayPayeeName, 'arrayPaymentTypeName': arrayPaymentTypeName, 'arrayContractNumber': arrayContractNumber },
                function (data) {
                Result = data; //Use this data for further creation of your elements.
                var items = "";
                //items += "<option value=''>Model Type</option>";
                $.each(data, function (i, SingleElement) {
                    var strDisplayOption = SingleElement;
                    items += "<option value='" + i + "'>" + strDisplayOption + "</option>";
                });

                if ($("#ddlPaymentExchangeEntity").val() != "") {
                    $("#ddlPaymentType").html(items);
                    $("#ddlPaymentType").prop("disabled", false);
                } else {
                    $("#ddlPaymentType").val('');
                    $("#ddlPaymentType").prop("disabled", true);
                }

                $("#ddlPaymentType").selectpicker('refresh');
            });
        }*@

        function ajaxGetAssignPaymentRecords_GetSearchCriteriaPaymentTypes(strSystem, strPaymentRecordStatusId,
                    arrayPayeeName, arrayPaymentTypeName, arrayContractNumber) {
            $.ajax({
                type: "GET",
                //type: "POST",
                url: "@Url.Action("AssignPaymentRecords_GetSearchCriteriaPaymentTypes")",
                data: {
                    'system': strSystem, 'paymentRecordStatusId': strPaymentRecordStatusId,
                    'arrayPayeeName': arrayPayeeName, 'arrayPaymentTypeName': arrayPaymentTypeName, 'arrayContractNumber': arrayContractNumber
                },
            contentType: "application/json; charset=utf-8",
            dataType: "json",
            traditional: true,  //This is required when passing array.
            success: function (data) {
                Result = data; //Use this data for further creation of your elements.
                var items = "";
                //items += "<option value=''>Model Type</option>";
                $.each(data, function (i, SingleElement) {
                    var strDisplayOption = SingleElement;
                    items += "<option value='" + i + "'>" + strDisplayOption + "</option>";
                });

                if ($("#ddlPaymentExchangeEntity").val() != "") {
                    $("#ddlPaymentType").html(items);
                    $("#ddlPaymentType").prop("disabled", false);
                } else {
                    $("#ddlPaymentType").val('');
                    $("#ddlPaymentType").prop("disabled", true);
                }

                $("#ddlPaymentType").selectpicker('refresh');
            },
            failure: function (response) {
                //alert(response.responseText);
                alert("BBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBB");
            },
            error: function (response) {
                alert("error returned from : AssignPaymentRecords_GetSearchCriteriaPaymentTypes");

                alert(response.responseText);



            }
        });
    }

        // ************************************************************************************************************

        $("#ddlSystem").val('0');                                   //Initialize to CAPMAN
        $("#ddlSystem").selectpicker('refresh');
        $("#ddlPaymentRecordStatus").val('0');                      //Initialize to UnAssigned
        $("#ddlPaymentRecordStatus").selectpicker('refresh');
        ajaxGetAssignPaymentRecords_GetSearchCriteriaPayees($("#ddlSystem option:selected").text(),     //Initialial Call to Populate Payee DropDown.
                                            $("#ddlPaymentRecordStatus option:selected").val(),
                                            GetSelectedOptionsAsArray("ddlPaymentExchangeEntity", true, false),
                                            GetSelectedOptionsAsArray("ddlPaymentType", false, true),
                                            GetSelectedOptionsAsArray("ddlContractNumber", false, true));
        ajaxGetAssignPaymentRecords_GetSearchCriteriaContracts($("#ddlSystem option:selected").text(),     //Initialial Call to Populate Contract DropDown.
                                            $("#ddlPaymentRecordStatus option:selected").val(),
                                            GetSelectedOptionsAsArray("ddlPaymentExchangeEntity", true, false),
                                            GetSelectedOptionsAsArray("ddlPaymentType", false, true),
                                            GetSelectedOptionsAsArray("ddlContractNumber", false, true));

        $("#ddlSystem").change(function () {
            // Reinitialize dropdowns to the right before proceeding.
            $('#ddlPaymentExchangeEntity').val('');
            $("#ddlPaymentExchangeEntity").prop("selected", false);
            $('#ddlPaymentType').val('');
            $("#ddlPaymentType").prop("selected", false);
            $('#ddlContractNumber').val('');
            $("#ddlContractNumber").prop("selected", false);

            $("#ddlPaymentExchangeEntity").selectpicker('refresh');
            $("#ddlPaymentType").selectpicker('refresh');
            $("#ddlContractNumber").selectpicker('refresh');

            ajaxGetAssignPaymentRecords_GetSearchCriteriaPayees($("#ddlSystem option:selected").text(),
                                            $("#ddlPaymentRecordStatus option:selected").val(),
                                            GetSelectedOptionsAsArray("ddlPaymentExchangeEntity", true, false),
                                            GetSelectedOptionsAsArray("ddlPaymentType", false, true),
                                            GetSelectedOptionsAsArray("ddlContractNumber", false, true));
            ajaxGetAssignPaymentRecords_GetSearchCriteriaContracts($("#ddlSystem option:selected").text(),
                                            $("#ddlPaymentRecordStatus option:selected").val(),
                                            GetSelectedOptionsAsArray("ddlPaymentExchangeEntity", true, false),
                                            GetSelectedOptionsAsArray("ddlPaymentType", false, true),
                                            GetSelectedOptionsAsArray("ddlContractNumber", false, true));
        });
        $("#ddlPaymentRecordStatus").change(function () {
            if ($(this).val() === '1') {    //Assigned
                $("#btnAssign").html('<span class="glyphicon glyphicon-user"></span>&nbsp;ReAssign');
            } else {
                $("#btnAssign").html('<span class="glyphicon glyphicon-user"></span>&nbsp;Assign');
            }

            // Reinitialize dropdowns to the right before proceeding.
            $('#ddlPaymentExchangeEntity').val('');
            $("#ddlPaymentExchangeEntity").prop("selected", false);
            $('#ddlPaymentType').val('');
            $("#ddlPaymentType").prop("selected", false);
            $('#ddlContractNumber').val('');
            $("#ddlContractNumber").prop("selected", false);

            $("#ddlPaymentExchangeEntity").selectpicker('refresh');
            $("#ddlPaymentType").selectpicker('refresh');
            $("#ddlContractNumber").selectpicker('refresh');

            ajaxGetAssignPaymentRecords_GetSearchCriteriaPayees($("#ddlSystem option:selected").text(),
                                            $("#ddlPaymentRecordStatus option:selected").val(),
                                            GetSelectedOptionsAsArray("ddlPaymentExchangeEntity", true, false),
                                            GetSelectedOptionsAsArray("ddlPaymentType", false, true),
                                            GetSelectedOptionsAsArray("ddlContractNumber", false, true));
            ajaxGetAssignPaymentRecords_GetSearchCriteriaContracts($("#ddlSystem option:selected").text(),
                                            $("#ddlPaymentRecordStatus option:selected").val(),
                                            GetSelectedOptionsAsArray("ddlPaymentExchangeEntity", true, false),
                                            GetSelectedOptionsAsArray("ddlPaymentType", false, true),
                                            GetSelectedOptionsAsArray("ddlContractNumber", false, true));
        });
        $("#ddlPaymentExchangeEntity").change(function () {
            // Reinitialize dropdowns to the right before proceeding.
            $('#ddlPaymentType').val('');
            $("#ddlPaymentType").prop("selected", false);
            $('#ddlContractNumber').val('');
            $("#ddlContractNumber").prop("selected", false);

            $("#ddlPaymentType").selectpicker('refresh');
            $("#ddlContractNumber").selectpicker('refresh');

            ajaxGetAssignPaymentRecords_GetSearchCriteriaPaymentTypes($("#ddlSystem option:selected").text(),
                                            $("#ddlPaymentRecordStatus option:selected").val(),
                                            GetSelectedOptionsAsArray("ddlPaymentExchangeEntity", true, false),
                                            GetSelectedOptionsAsArray("ddlPaymentType", false, true),
                                            GetSelectedOptionsAsArray("ddlContractNumber", false, true));
            ajaxGetAssignPaymentRecords_GetSearchCriteriaContracts($("#ddlSystem option:selected").text(),
                                            $("#ddlPaymentRecordStatus option:selected").val(),
                                            GetSelectedOptionsAsArray("ddlPaymentExchangeEntity", true, false),
                                            GetSelectedOptionsAsArray("ddlPaymentType", false, true),
                                            GetSelectedOptionsAsArray("ddlContractNumber", false, true));
        });
        $("#ddlPaymentType").change(function () {
            // Reinitialize dropdowns to the right before proceeding.
            $('#ddlContractNumber').val('');
            $("#ddlContractNumber").prop("selected", false);

            $("#ddlContractNumber").selectpicker('refresh');

            ajaxGetAssignPaymentRecords_GetSearchCriteriaContracts($("#ddlSystem option:selected").text(),
                                            $("#ddlPaymentRecordStatus option:selected").val(),
                                            GetSelectedOptionsAsArray("ddlPaymentExchangeEntity", true, false),
                                            GetSelectedOptionsAsArray("ddlPaymentType", false, true),
                                            GetSelectedOptionsAsArray("ddlContractNumber", false, true));
        });
        $("#btnReset").click(function () {
            $('#ddlSystem').val('0').trigger('change');
            $("#ddlSystem").prop("disabled", false);
            $('#ddlPaymentRecordStatus').val('0').trigger('change');
            $("#ddlPaymentRecordStatus").prop("disabled", false);
            $('#ddlPaymentExchangeEntity').val('');
            $("#ddlPaymentExchangeEntity").prop("disabled", false);
            $('#ddlPaymentType').val('');
            $("#ddlPaymentType").prop("disabled", false);
            $('#ddlContractNumber').val('');
            $("#ddlContractNumber").prop("disabled", false);

            $("#ddlSystem").selectpicker('refresh');
            $("#ddlPaymentRecordStatus").selectpicker('refresh');
            $("#ddlPaymentExchangeEntity").selectpicker('refresh');
            $("#ddlPaymentType").selectpicker('refresh');
            $("#ddlContractNumber").selectpicker('refresh');
        });

        $("#btnSearchMenu").click(function () {
            $(this).toggleClass("btn-dhcs-secondary");
            $(this).toggleClass("btn-dhcs-primary");
        });






        // ************************************************************************************************************

        // Initialize Popovers ****************************************************************************************
        $('[data-toggle="popover"]').popover();
        // ************************************************************************************************************


        // Add event listener for flag button on Payee-PaymentType Level **********************************************
        function unHoldPaymentRecords() {
            var retHtmlHeaderString = 'UnHold Payment';
            var retHtmlString = '' +
            '<div class="container-fluid">' +
                '<div class="form-group" style="padding-top:15px;">' +
                    '<label for="txtareaUnHoldComment">Comment:</label>' +
                    '<textarea class="form-control" id="txtareaUnHoldComment" placeholder="Comment Required" rows="10"></textarea>' +
                '</div>' +
                '<div class="alert alert-danger" style="display: none; margin-top: 10px;" id="danger_alert"></div>' +
            '</div>';

            $("#modalHeaderForUnHold").html(retHtmlHeaderString);
            $("#modalBodyForUnHold").html(retHtmlString);
            $('#modalWrapperForUnHold').modal('show');

            $("#txtareaUnHoldComment").on("change keyup paste", function () {
                var maxLength = maxLengthOfCommentsTextArea;
                var currentVal = $(this).val();
                var currentLength = $(this).val().length;
                if (currentLength > maxLength) {
                    $("#modalWrapperForUnHold #danger_alert").html("Your entry of <span style='color:blue;'>" + currentLength + "</span> " +
                        "characters exceeds the maximum <span style='color:blue;'>" + maxLength + "</span> characters allowed." +
                        "<br />Please reduce the number of characters entered.");
                    $("#modalWrapperForUnHold #danger_alert").slideDown();
                    $('#modalFooterForUnHold_UnHoldBtn').prop("disabled", true);
                }
                else {
                    $('#modalFooterForUnHold_UnHoldBtn').prop("disabled", false);
                    $("#modalWrapperForUnHold #danger_alert").slideUp();
                }
            });

            $("#modalFooterForUnHold_CancelBtn").on("click", function () {
                $('#modalFooterForUnHold_UnHoldBtn').prop("disabled", false);
            });
        }

        function getWarning_PayeePaymentTypesRowNotExpanded() {
            var retHtmlHeaderString = '<span class="glyphicon glyphicon-warning-sign EAMI_Text_Warning"></span> Warning';
            var retHtmlString = '' +
            '<div class="container-fluid">' +
                '<div class="alert alert-warning" style="display: none; margin-top: 10px;" id="warning_alert"></div>' +
            '</div>';
            $("#modalHeaderForMixedPaymentRecordsSelected").html(retHtmlHeaderString);
            $("#modalBodyForMixedPaymentRecordsSelected").html(retHtmlString);
            $('#modalWrapperForMixedPaymentRecordsSelected').modal('show');
            $("#modalWrapperForMixedPaymentRecordsSelected #warning_alert").html("Payee-PaymentType row must " +
                "be expanded and payment records checked before proceeding.");
            $("#modalWrapperForMixedPaymentRecordsSelected #warning_alert").show();
        }

        function getWarning_MixedPaymentRecordsSelected() {
            var retHtmlHeaderString = '<span class="glyphicon glyphicon-warning-sign EAMI_Text_Warning"></span> Warning';
            var retHtmlString = '' +
            '<div class="container-fluid">' +
                '<div class="alert alert-warning" style="display: none; margin-top: 10px;" id="warning_alert"></div>' +
            '</div>';
            $("#modalHeaderForMixedPaymentRecordsSelected").html(retHtmlHeaderString);
            $("#modalBodyForMixedPaymentRecordsSelected").html(retHtmlString);
            $('#modalWrapperForMixedPaymentRecordsSelected').modal('show');
            $("#modalWrapperForMixedPaymentRecordsSelected #warning_alert").html("<p>To UnHold, please ensure that ONLY " +
                "Payment Records flagged as <span class='glyphicon glyphicon-flag wrapperOnHold' style='cursor:auto;'></span> " +
                "On Hold are checked.</p>" +
                //"<p>To Complete or Deny Returns, please ensure that ONLY Payment Records flagged as " +
                //"<span class='glyphicon glyphicon-flag wrapperSentBackFromProcessor' style='cursor:auto;'></span> " +
                //"Processor Returned are checked.</p");
                "<p>To Complete or Deny Returns <span class='glyphicon glyphicon-flag wrapperSentBackFromProcessor' style='cursor:auto;'></span>" +
                ", please goto the Approvals Screen.</p");
            $("#modalWrapperForMixedPaymentRecordsSelected #warning_alert").show();
        }


        // ************************************************************************************************************





    });











</script>
